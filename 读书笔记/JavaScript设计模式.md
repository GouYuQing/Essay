# 《JavaScript设计模式与开发实践》-精读

## 1.概念

设计模式是解决某个特定场景下对某种问题的解决方案。

遵循原则：“找出程序中变化的地方，并将变化封装起来“

## 2.基础知识

### （1）面向对象的JavaScript

JavaScript没有类式继承，而是通过原型委托的方式来实现对象和对象之间的继承

#### 1.1 动态类型语言和鸭子类型

**动态静态语言类型**

静态类型语言在编译时便已确定变量的类型，而动态类型语言的变量类型要到程序运行的时 候，待变量被赋予某个值之后，才会具有某种类型。

| 类型         | 优点                                                         | 缺点                                                         |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 静态类型语言 | 1.在编译时就能发现类型不匹配的错误<br />2.避免运行期间会发生的错误<br />3.提前声明数据类型，可以对程序进行优化、提高程序执行速度 | 1.迫使程序员依照强契约来编写程序，辅助我们编写可靠性高程序<br />2.编写程序过程中，陷入细节，从业务逻辑上分散开 |
| 动态类型语言 | 1.代码量减少<br />2.把精力放在业务逻辑上<br />3.利于阅读，业务专注逻辑表达了<br />4.不考虑类型，给实际编码带来灵活性 | 1.无法保证变量类型<br />2.运行期间才能发现和类型相关的错误   |

**鸭子类型**

通俗说法：如果它走起来像鸭子，叫起来也是鸭子，那么它就是鸭子

告诉我们不管这个对象是谁，到底是鸡还是鸭并不重要，只要它走路像鸭子，叫起来也是鸭子，就认为它是鸭子，鸭子类型指导我们只关注对象的行为，而不关注对象本身，也就是关注 HAS-A, 而不是 IS-A。

利用鸭子类型的思想，我们不必借助超类型的帮助，就能轻松地在动态类型语言中实现一个原则：“面向接口编程，而不是面向实现编程”。

如果一个对象有push、pop方法且可以正确实现，他就可以被当成栈来进行使用

面向接口编程是设计模式中最重要的思想，但是在JavaScript中实现面向接口编程和主流的静态语言的面向接口编程大相径庭。

#### 1.2多态

多态的实际含义是：同一操作作用于不同的对象上面，可以产生不同的解释和不同的执行结 果。换句话说给不同的对象发送同一个消息的时候，这些对象会根据这个消息分别给出不同的反馈

##### 1.2.1多态的代码

```js
var makeSound = function( animal ){ 
 	if ( animal instanceof Duck ){ 
 		console.log( '嘎嘎嘎' ); 
 	}else if ( animal instanceof Chicken ){ 
 		console.log( '咯咯咯' ); 
 	} 
}; 
var Duck = function(){}; 
var Chicken = function(){}; 
makeSound( new Duck() ); // 嘎嘎嘎
makeSound( new Chicken() ); // 咯咯咯
```

这段代码，鸡鸭根据消息的不同做出了各自不同的反应，如果再添加狗呢？就需要增加代码，在makeSound里面，修改代码是危险的，我们应该对修改关闭。

把不变的部分隔离出来，把可变的部分封装起来，增加程序的扩展性，符合开放—封闭原则，相对于修改代码来说， 仅仅增加代码就能完成同样的功能，更安全。

##### 1.2.2对象的多态性

```js
let Duck = function(){} 
Duck.prototype.sound = function(){ 
 	console.log( '嘎嘎嘎' ); 
}; 
let Chicken = function(){} 
Chicken.prototype.sound = function(){ 
 	console.log( '咯咯咯' ); 
}; 
makeSound( new Duck() ); // 嘎嘎嘎
makeSound( new Chicken() ); // 咯咯
// 不再需要修改代码 只需要增加代码就好
```

##### 1.2.3 JavaScript的多态

多态思想就是把做什么和谁去做分离开来，要实现 这一点，归根结底先要消除类型之间的耦合关系，Java通过向上转型来实现多态，JavaScript对象的多态性与生俱来， 作为一门动态类型语言，它在编译时没有类型 检查的过程，既没有检查创建的对象类型，又没有检查传递的参数类型，我们可以往 makeSound 函数里传递 duck 对象当作参数，也可以传递 chicken 对象当作参数。

#### 1.3封装

封装的目的是将信息隐藏

##### 1.3.1 封装数据

一般封装数据是由语法解析来实现的，这些语言也许提供了 private、 public、protected 等关键字来提供不同的访问权限。 但 JavaScript 并没有提供对这些关键字的支持，我们只能依赖变量的作用域来实现封装特性， 而且只能模拟出 public 和 private 这两种封装性。

es6中提供let,一般我们通过函数来创建作用域,在es6中还可以通过函数来创建作用域

```js
var myObject = (function(){ 
 	var __name = 'sven'; // 私有（private）变量
 	return { 
 		getName: function(){ // 公开（public）方法
 			return __name; 
 		} 
 	} 
})(); 
console.log( myObject.getName() ); // 输出：sven 
console.log( myObject.__name ) // 输出：undefined 
```

##### 1.3.2 封装实现

不仅封装数据，封装变化，还包括隐藏实现细节、设计细节以及隐藏对象的类型

封装使得对象内部的变化对其他对象而言是不可见的，对象对它自己的行为负责。其他对象或者用户都不关心它的内部实现。封装使得对象之间的耦合度降低。

拿迭代器来说明，迭代器的作用是在不暴露一个聚合对象的内部表示的前提下，提供一种方式来顺序访问这个聚合对象。

